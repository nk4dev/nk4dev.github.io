<!DOCTYPE html><html><head><meta property="og:locale" charSet="UTF-8" content="en_US" data-next-head=""/><meta name="viewport" content="width=device-width, initial-scale=1.0" data-next-head=""/><title data-next-head="">OpenNextでchakra UIが動かない時の修正法 | nknighta</title><meta name="google-site-verification" content="FadhJDiAEFAdginv7Ttd1S3Ord4FWPtK3dnlKRAKeJo" data-next-head=""/><meta name="description" content="Nknight AMAMIYA&#x27;S Blog" data-next-head=""/><meta property="og:url" content="https://nknighta.me/blog/ikl0s8wba0" data-next-head=""/><meta property="og:title" content="OpenNextでchakra UIが動かない時の修正法 | nknighta" data-next-head=""/><meta property="og:site_name" content="Nknight AMAMIYA@nk4dev" data-next-head=""/><meta property="og:description" content="Nknight AMAMIYA&#x27;S Blog" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><meta property="og:image" content="https://ogp-img-gen.vercel.app/api/img-gen?text=OpenNextでchakra UIが動かない時の修正法 | nknighta" data-next-head=""/><meta property="og:image:width" content="1280" data-next-head=""/><meta property="og:image:height" content="640" data-next-head=""/><meta property="og:image:alt" content="nknighta" data-next-head=""/><meta property="twitter:description" content="NknightA blog" data-next-head=""/><meta name="twitter:image" content="https://ogp-img-gen.vercel.app/api/img-gen?text=OpenNextでchakra UIが動かない時の修正法 | nknighta" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:creator" content="@nk4dev" data-next-head=""/><meta name="twitter:creator:id" content="nk4dev" data-next-head=""/><meta name="twitter:description" content="Nknight AMAMIYA&#x27;s Twitter" data-next-head=""/><meta name="twitter:site" content="@nk4dev" data-next-head=""/><meta name="twitter:title" content="OpenNextでchakra UIが動かない時の修正法 | nknighta" data-next-head=""/><link rel="icon" href="/favicon.ico" sizes="any" data-next-head=""/><link rel="canonical" href="https://nknighta.me/blog/ikl0s8wba0" data-next-head=""/><link rel="preload" href="/_next/static/chunks/261b1423b252a008.css" as="style"/><link rel="stylesheet" href="/_next/static/chunks/261b1423b252a008.css" data-n-g=""/><noscript data-n-css=""></noscript><script src="/_next/static/chunks/2a61ec74f5915e73.js" defer=""></script><script src="/_next/static/chunks/28292bb40169f017.js" defer=""></script><script src="/_next/static/chunks/8fbbf0657c60ef87.js" defer=""></script><script src="/_next/static/chunks/2b1908bd1ecc2c04.js" defer=""></script><script src="/_next/static/chunks/0dacfc9734e8d32b.js" defer=""></script><script src="/_next/static/chunks/323d277a261fe705.js" defer=""></script><script src="/_next/static/chunks/turbopack-38d4b9ea7fd2ad40.js" defer=""></script><script src="/_next/static/chunks/b080c3554a35f59e.js" defer=""></script><script src="/_next/static/chunks/b7182d9f6ad53e32.js" defer=""></script><script src="/_next/static/chunks/turbopack-219efb25bbeb5e5c.js" defer=""></script><script src="/_next/static/rfoQLvIVTW2S-3tHH_l8R/_ssgManifest.js" defer=""></script><script src="/_next/static/rfoQLvIVTW2S-3tHH_l8R/_buildManifest.js" defer=""></script></head><body><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-9TG7JEDDCX"></script><div id="__next"><div><script>
                        window.dataLayer = window.dataLayer || [];
                        function gtag(){dataLayer.push(arguments);}
                        gtag('js', new Date());
                        gtag('config', 'G-9TG7JEDDCX', {
                            page_path: window.location.pathname,
                        });
                    </script><div style="width:100%;height:100%;position:relative"><canvas style="position:absolute;inset:0;pointer-events:none"></canvas><div class="bg_#050021 c_#f0d0ff"><div class="d_flex jc_center fs_30px p_40px bd-b_1px_solid_#f0d0ff"><a class="tsh_0_10px_30px_#aa00ff bdr_5px p_10px c_#f0d0ff" href="/">Nknight AMAMIYA</a></div><div class="d_flex flex-d_column jc_center p_10px bd-b_1px_solid_#f0d0ff"><div class="w_100% d_flex jc_center"><a class="tsh_0_10px_30px_#aa00ff bdr_5px c_#f0d0ff m_0_5px" href="/blog/">Blog</a><a class="tsh_0_10px_30px_#aa00ff bdr_5px c_#f0d0ff m_0_5px" href="/dev/">Dev Projects</a></div><div class="w_100% d_flex jc_center"><a class="tsh_0_10px_30px_#aa00ff bdr_5px c_#f0d0ff m_0_5px" href="/apps/">Apps</a><a class="tsh_0_10px_30px_#aa00ff bdr_5px c_#f0d0ff m_0_5px" href="/videos/">Videos</a></div></div><main><div class="pos_fixed top_0 left_0 w_100% h_5px bg-c_#aa00ff trf-o_0%_50% z_9999" style="transform:scaleX(0)"></div><div class="w_100% h_300px pos_relative ov_hidden"><img loading="lazy" decoding="async" data-nimg="fill" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;object-fit:cover;color:transparent" src="https://images.microcms-assets.io/assets/a2939c8d25434ae5a1f853f2dc239a0f/9cedf20330d04ef1bfc9099f6e7aa7c8/chakraui.jpg"/><div class="pos_absolute top_0 left_0 w_100% h_100%"></div></div><div class="fs_30px p_40px bd-b_1px_solid_#f0d0ff">OpenNextでchakra UIが動かない時の修正法<p>2025/9/13 - 23 : 26</p></div><div class="p_4"><div class="gap_14px d_flex flex-d_column jc_center py_10px max-w_800px m_0_auto lh_1.6"><div><p>先日Nextjs+ChakraUIで作成したアプリケーションをCloudflareにデプロイしようと思ったのですがエラーが出まくってしょうがなかったので対処法を書いておきます。</p><h2 id="h9f510f3156">やりたいこと</h2><p>Nextjs+ChakraUIのWebアプリをCloudflareにデプロイ</p><h2 id="h1619609f8c">エラーコマンドとエラー表示</h2><p>code<p><pre style="overflow: scroll; background: #000; padding: 10px; border-radius: 5px; color: #fff; border: 1px solid #ccc;"><code class="language-shell">$npx opennextjs-cloudflare build

...[中略]...

[ERROR] Could not resolve &quot;jose&quot;

    .open-next/server-functions/default/node_modules/next-auth/jwt/index.js:15:20:
      15 │ var _jose = require(&quot;jose&quot;);
         ╵                     ~~~~~~

  The module &quot;./dist/browser/index.js&quot; was not found on the file system:

    .open-next/server-functions/default/node_modules/jose/package.json:68:17:
      68 │       &quot;workerd&quot;: &quot;./dist/browser/index.js&quot;,
         ╵                  ~~~~~~~~~~~~~~~~~~~~~~~~~

  You can mark the path &quot;jose&quot; as external to exclude it from the bundle, which will remove this
  error and leave the unresolved path in the bundle. You can also surround this &quot;require&quot; call with
  a try/catch block to handle this failure at run-time instead of bundle-time.

✘ [ERROR] Could not resolve &quot;@panva/hkdf&quot;

    .open-next/server-functions/default/node_modules/next-auth/jwt/index.js:16:43:
      16 │ var _hkdf = _interopRequireDefault(require(&quot;@panva/hkdf&quot;));
         ╵                                            ~~~~~~~~~~~~~

  The module &quot;./dist/web/index.js&quot; was not found on the file system:

    .open-next/server-functions/default/node_modules/@panva/hkdf/package.json:33:17:
      33 │       &quot;workerd&quot;: &quot;./dist/web/index.js&quot;,
         ╵                  ~~~~~~~~~~~~~~~~~~~~~

  You can mark the path &quot;@panva/hkdf&quot; as external to exclude it from the bundle, which will remove
  this error and leave the unresolved path in the bundle. You can also surround this &quot;require&quot; call
  with a try/catch block to handle this failure at run-time instead of bundle-time.

✘ [ERROR] Could not resolve &quot;jose&quot;

    .open-next/server-functions/default/node_modules/openid-client/lib/helpers/client.js:1:21:
      1 │ const jose = require(&apos;jose&apos;);
        ╵                      ~~~~~~

  The module &quot;./dist/browser/index.js&quot; was not found on </code></pre><h2 id="h1c2bcaa1fd">原因と修正</h2><h3 id="h9c1f22bd6d">原因</h3><p>ChakraUIの依存関係である@emotionがビルド時に読み込まれていなかった...</p><p>next.config.jsを修正</p><div class="iframely-embed"><div class="iframely-responsive" style="padding-bottom: 50%;"><a href="https://gist.github.com/nk4dev/d46d42a549dac2c13c3333a063b14d05" data-iframely-url="https://cdn.iframe.ly/api/iframe?url=https%3A%2F%2Fgist.github.com%2Fnk4dev%2Fd46d42a549dac2c13c3333a063b14d05&amp;key=c271a3ec77ff4aa44d5948170dd74161"></a></div></div><script async src="https://cdn.iframe.ly/embed.js" charset="utf-8"></script><p>再度ビルドしたら通りましたー</p><h3 id="h6a5297362b">追記</h3><h3 id="h7295077a0f">エラーの原因(?)</h3><p>ビルド時のエラーについて、opennext側でビルドする際になぜかはわかりませんがライブラリをコピーしているっぽいのでこれが原因なのかなぁ...??</p><p>通常のnext buildとopennextのビルドは挙動がちがうので予測できない動きしちゃって難しい</p><p>code<p><pre style="overflow: scroll; background: #000; padding: 10px; border-radius: 5px; color: #fff; border: 1px solid #ccc;"><code>undling middleware function...
DEBUG OpenNext Resolve plugin for middleware
DEBUG OpenNext Edge plugin
DEBUG OpenNext Replacement plugin externalMiddlewareOverrides Delete override includeCacheInMiddleware
Bundling static assets...
Bundling cache assets...
Building server function: default...
DEBUG copyTracedFiles: 224308 ms
DEBUG Copying package using a workerd condition: node_modules/@emotion/cache -&gt; .open-next/server-functions/default/node_modules/@emotion/cache
DEBUG Copying package using a workerd condition: node_modules/@panva/hkdf -&gt; .open-next/server-functions/default/node_modules/@panva/hkdf
DEBUG Copying package using a workerd condition: node_modules/next-auth/node_modules/jose -&gt; .open-next/server-functions/default/node_modules/next-auth/node_modules/jose
DEBUG Copying package using a workerd condition: node_modules/openid-client/node_modules/jose -&gt; .open-next/server-functions/default/node_modules/openid-client/node_modules/jose</code></pre><h2 id="he4ba96ecb5">リンク</h2><p><a href="https://chakra-ui.com/">https://chakra-ui.com/</a></p><p><a href="https://opennext.js.org/">https://opennext.js.org/</a></p><p><a href="https://nextjs.org" target="_blank" rel="noopener noreferrer">https://nextjs.org</a></p><p></p><p></p></div><a href="/blog/">Back to blog</a></div></div></main><footer><div class="d_flex jc_center flex-d_column ai_center p_7vh bd-t_1px_solid_#f0d0ff bg_#000 pb_15vh"><div class="mb_20px"><p>Share this page:</p><div class="d_flex jc_center"><button class="bg_transparent bd_1px_solid_#f0d0ff c_#f0d0ff cursor_pointer p_10px_20px td_underline [&amp;:hover]:bg_#f0d0ff [&amp;:hover]:c_#050021 [&amp;:hover]:td_none">Share on X</button></div></div><div>(c) Nknight AMAMIYA 2021</div><a class="bdr_5px p_10px_40px c_#f0d0ff" href="https://varius.technology/">varius.technology</a><a class="bdr_5px p_10px_40px c_#f0d0ff" href="https://nknighta.me">nknighta.me</a><a class="bdr_5px p_10px_40px c_#f0d0ff" href="/llmassets/">LLM Assets</a><div class="d_flex jc_center flex-d_column ai_center bdr_5px p_10px_40px c_#f0d0ff">- Mail -<a aria-label="Open email app" class="bdr_5px p_10px_40px c_#f0d0ff" href="mailto:nknighta@varius.technology">nknighta@varius.technology</a></div></div></footer></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"blog":{"id":"ikl0s8wba0","createdAt":"2025-09-13T14:14:33.557Z","updatedAt":"2025-09-13T16:49:05.641Z","publishedAt":"2025-09-13T14:26:05.610Z","revisedAt":"2025-09-13T16:49:05.641Z","title":"OpenNextでchakra UIが動かない時の修正法","content":"\u003cp\u003e先日Nextjs+ChakraUIで作成したアプリケーションをCloudflareにデプロイしようと思ったのですがエラーが出まくってしょうがなかったので対処法を書いておきます。\u003c/p\u003e\u003ch2 id=\"h9f510f3156\"\u003eやりたいこと\u003c/h2\u003e\u003cp\u003eNextjs+ChakraUIのWebアプリをCloudflareにデプロイ\u003c/p\u003e\u003ch2 id=\"h1619609f8c\"\u003eエラーコマンドとエラー表示\u003c/h2\u003e\u003cpre\u003e\u003ccode class=\"language-shell\"\u003e$npx opennextjs-cloudflare build\n\n...[中略]...\n\n[ERROR] Could not resolve \u0026quot;jose\u0026quot;\n\n    .open-next/server-functions/default/node_modules/next-auth/jwt/index.js:15:20:\n      15 │ var _jose = require(\u0026quot;jose\u0026quot;);\n         ╵                     ~~~~~~\n\n  The module \u0026quot;./dist/browser/index.js\u0026quot; was not found on the file system:\n\n    .open-next/server-functions/default/node_modules/jose/package.json:68:17:\n      68 │       \u0026quot;workerd\u0026quot;: \u0026quot;./dist/browser/index.js\u0026quot;,\n         ╵                  ~~~~~~~~~~~~~~~~~~~~~~~~~\n\n  You can mark the path \u0026quot;jose\u0026quot; as external to exclude it from the bundle, which will remove this\n  error and leave the unresolved path in the bundle. You can also surround this \u0026quot;require\u0026quot; call with\n  a try/catch block to handle this failure at run-time instead of bundle-time.\n\n✘ [ERROR] Could not resolve \u0026quot;@panva/hkdf\u0026quot;\n\n    .open-next/server-functions/default/node_modules/next-auth/jwt/index.js:16:43:\n      16 │ var _hkdf = _interopRequireDefault(require(\u0026quot;@panva/hkdf\u0026quot;));\n         ╵                                            ~~~~~~~~~~~~~\n\n  The module \u0026quot;./dist/web/index.js\u0026quot; was not found on the file system:\n\n    .open-next/server-functions/default/node_modules/@panva/hkdf/package.json:33:17:\n      33 │       \u0026quot;workerd\u0026quot;: \u0026quot;./dist/web/index.js\u0026quot;,\n         ╵                  ~~~~~~~~~~~~~~~~~~~~~\n\n  You can mark the path \u0026quot;@panva/hkdf\u0026quot; as external to exclude it from the bundle, which will remove\n  this error and leave the unresolved path in the bundle. You can also surround this \u0026quot;require\u0026quot; call\n  with a try/catch block to handle this failure at run-time instead of bundle-time.\n\n✘ [ERROR] Could not resolve \u0026quot;jose\u0026quot;\n\n    .open-next/server-functions/default/node_modules/openid-client/lib/helpers/client.js:1:21:\n      1 │ const jose = require(\u0026apos;jose\u0026apos;);\n        ╵                      ~~~~~~\n\n  The module \u0026quot;./dist/browser/index.js\u0026quot; was not found on \u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"h1c2bcaa1fd\"\u003e原因と修正\u003c/h2\u003e\u003ch3 id=\"h9c1f22bd6d\"\u003e原因\u003c/h3\u003e\u003cp\u003eChakraUIの依存関係である@emotionがビルド時に読み込まれていなかった...\u003c/p\u003e\u003cp\u003enext.config.jsを修正\u003c/p\u003e\u003cdiv class=\"iframely-embed\"\u003e\u003cdiv class=\"iframely-responsive\" style=\"padding-bottom: 50%;\"\u003e\u003ca href=\"https://gist.github.com/nk4dev/d46d42a549dac2c13c3333a063b14d05\" data-iframely-url=\"https://cdn.iframe.ly/api/iframe?url=https%3A%2F%2Fgist.github.com%2Fnk4dev%2Fd46d42a549dac2c13c3333a063b14d05\u0026amp;key=c271a3ec77ff4aa44d5948170dd74161\"\u003e\u003c/a\u003e\u003c/div\u003e\u003c/div\u003e\u003cscript async src=\"https://cdn.iframe.ly/embed.js\" charset=\"utf-8\"\u003e\u003c/script\u003e\u003cp\u003e再度ビルドしたら通りましたー\u003c/p\u003e\u003ch3 id=\"h6a5297362b\"\u003e追記\u003c/h3\u003e\u003ch3 id=\"h7295077a0f\"\u003eエラーの原因(?)\u003c/h3\u003e\u003cp\u003eビルド時のエラーについて、opennext側でビルドする際になぜかはわかりませんがライブラリをコピーしているっぽいのでこれが原因なのかなぁ...??\u003c/p\u003e\u003cp\u003e通常のnext buildとopennextのビルドは挙動がちがうので予測できない動きしちゃって難しい\u003c/p\u003e\u003cpre\u003e\u003ccode\u003eundling middleware function...\nDEBUG OpenNext Resolve plugin for middleware\nDEBUG OpenNext Edge plugin\nDEBUG OpenNext Replacement plugin externalMiddlewareOverrides Delete override includeCacheInMiddleware\nBundling static assets...\nBundling cache assets...\nBuilding server function: default...\nDEBUG copyTracedFiles: 224308 ms\nDEBUG Copying package using a workerd condition: node_modules/@emotion/cache -\u0026gt; .open-next/server-functions/default/node_modules/@emotion/cache\nDEBUG Copying package using a workerd condition: node_modules/@panva/hkdf -\u0026gt; .open-next/server-functions/default/node_modules/@panva/hkdf\nDEBUG Copying package using a workerd condition: node_modules/next-auth/node_modules/jose -\u0026gt; .open-next/server-functions/default/node_modules/next-auth/node_modules/jose\nDEBUG Copying package using a workerd condition: node_modules/openid-client/node_modules/jose -\u0026gt; .open-next/server-functions/default/node_modules/openid-client/node_modules/jose\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"he4ba96ecb5\"\u003eリンク\u003c/h2\u003e\u003cp\u003e\u003ca href=\"https://chakra-ui.com/\"\u003ehttps://chakra-ui.com/\u003c/a\u003e\u003c/p\u003e\u003cp\u003e\u003ca href=\"https://opennext.js.org/\"\u003ehttps://opennext.js.org/\u003c/a\u003e\u003c/p\u003e\u003cp\u003e\u003ca href=\"https://nextjs.org\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ehttps://nextjs.org\u003c/a\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e","eyecatch":{"url":"https://images.microcms-assets.io/assets/a2939c8d25434ae5a1f853f2dc239a0f/9cedf20330d04ef1bfc9099f6e7aa7c8/chakraui.jpg","height":579,"width":993},"category":null}},"__N_SSG":true},"page":"/blog/[id]","query":{"id":"ikl0s8wba0"},"buildId":"rfoQLvIVTW2S-3tHH_l8R","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>