{"pageProps":{"blog":{"id":"ikl0s8wba0","createdAt":"2025-09-13T14:14:33.557Z","updatedAt":"2025-09-13T16:49:05.641Z","publishedAt":"2025-09-13T14:26:05.610Z","revisedAt":"2025-09-13T16:49:05.641Z","title":"OpenNextでchakra UIが動かない時の修正法","content":"<p>先日Nextjs+ChakraUIで作成したアプリケーションをCloudflareにデプロイしようと思ったのですがエラーが出まくってしょうがなかったので対処法を書いておきます。</p><h2 id=\"h9f510f3156\">やりたいこと</h2><p>Nextjs+ChakraUIのWebアプリをCloudflareにデプロイ</p><h2 id=\"h1619609f8c\">エラーコマンドとエラー表示</h2><pre><code class=\"language-shell\">$npx opennextjs-cloudflare build\n\n...[中略]...\n\n[ERROR] Could not resolve &quot;jose&quot;\n\n    .open-next/server-functions/default/node_modules/next-auth/jwt/index.js:15:20:\n      15 │ var _jose = require(&quot;jose&quot;);\n         ╵                     ~~~~~~\n\n  The module &quot;./dist/browser/index.js&quot; was not found on the file system:\n\n    .open-next/server-functions/default/node_modules/jose/package.json:68:17:\n      68 │       &quot;workerd&quot;: &quot;./dist/browser/index.js&quot;,\n         ╵                  ~~~~~~~~~~~~~~~~~~~~~~~~~\n\n  You can mark the path &quot;jose&quot; as external to exclude it from the bundle, which will remove this\n  error and leave the unresolved path in the bundle. You can also surround this &quot;require&quot; call with\n  a try/catch block to handle this failure at run-time instead of bundle-time.\n\n✘ [ERROR] Could not resolve &quot;@panva/hkdf&quot;\n\n    .open-next/server-functions/default/node_modules/next-auth/jwt/index.js:16:43:\n      16 │ var _hkdf = _interopRequireDefault(require(&quot;@panva/hkdf&quot;));\n         ╵                                            ~~~~~~~~~~~~~\n\n  The module &quot;./dist/web/index.js&quot; was not found on the file system:\n\n    .open-next/server-functions/default/node_modules/@panva/hkdf/package.json:33:17:\n      33 │       &quot;workerd&quot;: &quot;./dist/web/index.js&quot;,\n         ╵                  ~~~~~~~~~~~~~~~~~~~~~\n\n  You can mark the path &quot;@panva/hkdf&quot; as external to exclude it from the bundle, which will remove\n  this error and leave the unresolved path in the bundle. You can also surround this &quot;require&quot; call\n  with a try/catch block to handle this failure at run-time instead of bundle-time.\n\n✘ [ERROR] Could not resolve &quot;jose&quot;\n\n    .open-next/server-functions/default/node_modules/openid-client/lib/helpers/client.js:1:21:\n      1 │ const jose = require(&apos;jose&apos;);\n        ╵                      ~~~~~~\n\n  The module &quot;./dist/browser/index.js&quot; was not found on </code></pre><h2 id=\"h1c2bcaa1fd\">原因と修正</h2><h3 id=\"h9c1f22bd6d\">原因</h3><p>ChakraUIの依存関係である@emotionがビルド時に読み込まれていなかった...</p><p>next.config.jsを修正</p><div class=\"iframely-embed\"><div class=\"iframely-responsive\" style=\"padding-bottom: 50%;\"><a href=\"https://gist.github.com/nk4dev/d46d42a549dac2c13c3333a063b14d05\" data-iframely-url=\"https://cdn.iframe.ly/api/iframe?url=https%3A%2F%2Fgist.github.com%2Fnk4dev%2Fd46d42a549dac2c13c3333a063b14d05&amp;key=c271a3ec77ff4aa44d5948170dd74161\"></a></div></div><script async src=\"https://cdn.iframe.ly/embed.js\" charset=\"utf-8\"></script><p>再度ビルドしたら通りましたー</p><h3 id=\"h6a5297362b\">追記</h3><h3 id=\"h7295077a0f\">エラーの原因(?)</h3><p>ビルド時のエラーについて、opennext側でビルドする際になぜかはわかりませんがライブラリをコピーしているっぽいのでこれが原因なのかなぁ...??</p><p>通常のnext buildとopennextのビルドは挙動がちがうので予測できない動きしちゃって難しい</p><pre><code>undling middleware function...\nDEBUG OpenNext Resolve plugin for middleware\nDEBUG OpenNext Edge plugin\nDEBUG OpenNext Replacement plugin externalMiddlewareOverrides Delete override includeCacheInMiddleware\nBundling static assets...\nBundling cache assets...\nBuilding server function: default...\nDEBUG copyTracedFiles: 224308 ms\nDEBUG Copying package using a workerd condition: node_modules/@emotion/cache -&gt; .open-next/server-functions/default/node_modules/@emotion/cache\nDEBUG Copying package using a workerd condition: node_modules/@panva/hkdf -&gt; .open-next/server-functions/default/node_modules/@panva/hkdf\nDEBUG Copying package using a workerd condition: node_modules/next-auth/node_modules/jose -&gt; .open-next/server-functions/default/node_modules/next-auth/node_modules/jose\nDEBUG Copying package using a workerd condition: node_modules/openid-client/node_modules/jose -&gt; .open-next/server-functions/default/node_modules/openid-client/node_modules/jose</code></pre><h2 id=\"he4ba96ecb5\">リンク</h2><p><a href=\"https://chakra-ui.com/\">https://chakra-ui.com/</a></p><p><a href=\"https://opennext.js.org/\">https://opennext.js.org/</a></p><p><a href=\"https://nextjs.org\" target=\"_blank\" rel=\"noopener noreferrer\">https://nextjs.org</a></p><p></p><p></p>","eyecatch":{"url":"https://images.microcms-assets.io/assets/a2939c8d25434ae5a1f853f2dc239a0f/9cedf20330d04ef1bfc9099f6e7aa7c8/chakraui.jpg","height":579,"width":993},"category":null}},"__N_SSG":true}